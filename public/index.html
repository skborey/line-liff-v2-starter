<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
</head>

<body>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script>
        window.onload = function () {
    
            var liffId = "1654048483-NG5eBoKW";
            var endpoint = "https://tracechain.gatewayserviceth.com/#/"

            if (!liff.isInClient()) window.location = '/';
            else {
                initializeLiff(liffId, endpoint);
            }
        };

        /**
        * Initialize LIFF
        * @param {string} liffId The LIFF ID of the selected element
        */
        function initializeLiff(liffId, endpoint) {
            liff
                .init({
                    liffId: liffId
                })
                .then(() => {
                    if (liff.isInClient()) {
                        // start to use LIFF's api
                        getProfileAndRedirect(endpoint);
                    }
                })
                .catch((err) => {
                    console.log(err)
                });
        }

        /**
        * Initialize the app by calling functions handling individual app components
        */
        function getProfileAndRedirect(endpoint) {
            liff.getProfile().then(function (profile) {

                var url = endpoint + '?userID=' + profile.userId
                    + '&userName=' + profile.displayName
                    + '&province=Bangkok'

                const queryString = decodeURIComponent(window.location.search).replace("?liff.state=", "");
                const params = new URLSearchParams(queryString);
                const menu = params.get('menu');
                url += '&menu=' + ((menu != null && menu != '') ? menu : 'covidTracker');
                //Todo : IOS not work
                // liff.closeWindow();
                liff.openWindow({ url: url, external: true });
            }).catch(function (error) {
                //Todo : IOS not work
                // window.alert('Error getting profile: ' + error);
            });
        }
    </script>
</body>

</html>